name: sentinel
description: |
  Security gateway that intercepts and audits shell commands before execution.
  Uses deterministic blocklists + LLM semantic analysis with fail-closed policy.
version: 2.0.0
author: turnono
repository: https://github.com/turnono/sentinel
license: MIT

# Skill configuration
config:
  # Path to your Sentinel installation
  sentinel_path:
    type: string
    default: "~/.openclaw/skills/sentinel/sentinel"
    description: Path to Sentinel package
  
  # Path to constitution file
  constitution_path:
    type: string
    default: "~/.openclaw/skills/sentinel/constitution.yaml"
    description: Path to security policy constitution

  # Gemini model for LLM auditor
  model:
    type: string
    default: "gemini-2.0-flash"
    description: Model for semantic command analysis

# Tools provided by this skill
tools:
  - name: sentinel_exec
    description: |
      Execute a shell command through Sentinel security gateway.
      Commands are audited against security policy before execution.
      Blocked commands return an error with the rejection reason.
    parameters:
      command:
        type: string
        required: true
        description: Shell command to audit and execute
      workdir:
        type: string
        required: false
        description: Working directory for command execution
    handler: sentinel_exec.py

  - name: codewiki_ingest
    description: |
      Ingests architecture documentation from a Code Wiki URL.
      Returns summary and diagram links.
    parameters:
      url:
        type: string
        required: true
        description: URL of the Code Wiki page (e.g. https://codewiki.ai/p/...)
    handler: codewiki/codewiki.py
    
  - name: codewiki_query
    description: |
      Asks a question about the project architecture using Code Wiki.
    parameters:
      url:
        type: string
        required: true
        description: URL of the Code Wiki page
      question:
        type: string
        required: true
        description: Question to ask
    handler: codewiki/codewiki.py

  - name: sentinel_list_pending
    description: List all pending HITL approval requests.
    handler: sentinel_admin.py
    arguments:
      - list_pending

  - name: sentinel_approve_request
    description: Approve a pending HITL request by ID.
    parameters:
      request_id:
        type: string
        required: true
        description: The ID of the request to approve
    handler: sentinel_admin.py
    arguments:
      - approve
      - ${request_id}

# Environment requirements
requires:
  python: ">=3.10"
  packages:
    - google-adk
    - pyyaml
    - python-dotenv
    - requests
    - beautifulsoup4

# Security notes
security:
  - This skill requires GOOGLE_API_KEY for LLM auditing
  - Commands are logged to ~/.openclaw/skills/sentinel/logs/
  - Fail-closed policy: uncertain commands are rejected
